<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Connor Wiegand">

<title>Lab 2: tidyverse</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="lab2-2_files/libs/clipboard/clipboard.min.js"></script>
<script src="lab2-2_files/libs/quarto-html/quarto.js"></script>
<script src="lab2-2_files/libs/quarto-html/popper.min.js"></script>
<script src="lab2-2_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="lab2-2_files/libs/quarto-html/anchor.min.js"></script>
<link href="lab2-2_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="lab2-2_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="lab2-2_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="lab2-2_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="lab2-2_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#recall" id="toc-recall" class="nav-link active" data-scroll-target="#recall">Recall:</a>
  <ul>
  <li><a href="#the-tidyverse" id="toc-the-tidyverse" class="nav-link" data-scroll-target="#the-tidyverse">The <code>tidyverse</code></a></li>
  <li><a href="#tidy-data" id="toc-tidy-data" class="nav-link" data-scroll-target="#tidy-data">Tidy Data</a>
  <ul class="collapse">
  <li><a href="#ex." id="toc-ex." class="nav-link" data-scroll-target="#ex."><span class="ex">Ex.</span></a></li>
  </ul></li>
  </ul></li>
  <li><a href="#dplyr" id="toc-dplyr" class="nav-link" data-scroll-target="#dplyr"><code>dplyr</code></a>
  <ul>
  <li><a href="#filter-and-select" id="toc-filter-and-select" class="nav-link" data-scroll-target="#filter-and-select">Filter and Select</a>
  <ul class="collapse">
  <li><a href="#select" id="toc-select" class="nav-link" data-scroll-target="#select"><code>select</code></a>
  <ul class="collapse">
  <li><a href="#basic-information" id="toc-basic-information" class="nav-link" data-scroll-target="#basic-information">Basic information</a></li>
  <li><a href="#ex.-1" id="toc-ex.-1" class="nav-link" data-scroll-target="#ex.-1"><span class="ex">Ex.</span></a></li>
  <li><a href="#practice-questions" id="toc-practice-questions" class="nav-link" data-scroll-target="#practice-questions">Practice questions</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#filter" id="toc-filter" class="nav-link" data-scroll-target="#filter"><code>filter</code></a>
  <ul class="collapse">
  <li><a href="#basic-information-1" id="toc-basic-information-1" class="nav-link" data-scroll-target="#basic-information-1">Basic Information</a></li>
  <li><a href="#ex.-2" id="toc-ex.-2" class="nav-link" data-scroll-target="#ex.-2"><span class="ex">Ex.</span></a></li>
  <li><a href="#practice-questions-1" id="toc-practice-questions-1" class="nav-link" data-scroll-target="#practice-questions-1">Practice questions</a></li>
  </ul></li>
  <li><a href="#mutate" id="toc-mutate" class="nav-link" data-scroll-target="#mutate"><code>mutate</code></a></li>
  <li><a href="#aside-the-magrittr-pipe" id="toc-aside-the-magrittr-pipe" class="nav-link" data-scroll-target="#aside-the-magrittr-pipe">Aside: The <code>magrittr</code> pipe</a></li>
  <li><a href="#other-key-dplyr-verbs" id="toc-other-key-dplyr-verbs" class="nav-link" data-scroll-target="#other-key-dplyr-verbs">Other Key <code>dplyr</code> verbs</a>
  <ul class="collapse">
  <li><a href="#arrange" id="toc-arrange" class="nav-link" data-scroll-target="#arrange"><code>arrange</code></a></li>
  <li><a href="#group_by-and-summarize" id="toc-group_by-and-summarize" class="nav-link" data-scroll-target="#group_by-and-summarize"><code>group_by</code> and <code>summarize</code></a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Lab 2: <code>tidyverse</code></h1>
<p class="subtitle lead">Part 2: Key <code>dplyr</code> syntax</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Connor Wiegand </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="recall" class="level1">
<h1>Recall:</h1>
<section id="the-tidyverse" class="level2">
<h2 class="anchored" data-anchor-id="the-tidyverse">The <code>tidyverse</code></h2>
<p>The tidyverse is a collection of R packages that work in harmony for data science. The “tidy” framework is designed to be human-readable, and the functions within the tidyverse help facilitate data manipulation, visualization, and modeling. Establishing a working understanding of the tidyverse can serve as a broad foundational understanding of data science principles in R.</p>
<p>The main packages in the tidyverse include:</p>
<ul>
<li><code>ggplot2</code>: For data visualization</li>
<li><code>dplyr</code>: For data manipulation</li>
<li><code>stringr</code>: For string manipulation</li>
<li><code>tidyr</code>: For cleaning and reshaping data</li>
<li><code>readr</code>: For reading data into R</li>
<li><code>purrr</code>: For functional programming</li>
<li><code>tibble</code>: A modern approach to data frames</li>
<li><code>forcats</code>: For working with factors</li>
</ul>
<p>I have highlighted the first three above because they are the ones I (explicitly) use most. That is, I am looking at the help files for the functions within these packages most often.</p>
</section>
<section id="tidy-data" class="level2">
<h2 class="anchored" data-anchor-id="tidy-data">Tidy Data</h2>
<p>The tidyverse has a specific philosophy regarding how data should be organized. A dataset is <strong><em>tidy</em></strong> provided that</p>
<ul>
<li>Each variable is a column</li>
<li>Each observation is a row</li>
</ul>
<p>This structure makes it easier to manipulate, visualize, and model your data.</p>
<hr>
<section id="ex." class="level3">
<h3 class="anchored" data-anchor-id="ex."><span class="ex">Ex.</span></h3>
<hr>
</section>
</section>
</section>
<section id="dplyr" class="level1">
<h1><code>dplyr</code></h1>
<hr>
<p><code>dplyr</code> is one of the most popular packages in R for data manipulation. It is the most common and widely considered “best” starting place when learning data manipulation fundamentals in R. It offers a set of “verbs” to carry out essential data manipulation operations and is designed to be both flexible and intuitive.</p>
<p><strong>Core verbs</strong>: The power of dplyr comes from its core verbs that simplify data manipulation tasks. Here are the primary ones:</p>
<div class="columns">
<div class="column" style="width:50%;">
<ul>
<li><code>mutate</code><br>
</li>
<li><code>filter</code></li>
<li><code>arrange</code></li>
</ul>
</div><div class="column" style="width:50%;">
<ul>
<li><code>select</code></li>
<li><code>group_by</code></li>
<li><code>summarize</code><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></li>
</ul>
</div>
</div>
<p>In order to get started on <code>dplyr</code>, we need to have it installed (which you hopefully do already). We also need some example data to work with. See the blurb below</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note: Flights Data Set
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The flights dataset is a large data frame that contains information about domestic flights that departed from New York City in 2013. The dataset has various columns like providing various details about each flight. This dataset provides a comprehensive look at flight data, making it an excellent resource for data manipulation and analysis exercises. See the reference <a href="https://www.rdocumentation.org/packages/nycflights13/versions/1.0.1/topics/flights">here</a> for descriptions of each variable.</p>
<p>To use the flights dataset, you need to install and load the nycflights13 package, which contains this and other related datasets. You can install it from CRAN by running <code>install.packages("nycflights13")</code>.</p>
<p>Once we have loaded flights into our session (see below), we can use the <code>head()</code> and <code>glimpse()</code> functions to have a peek at the data. Try this for yourself!</p>
</div>
</div>
</div>
<p>Once everything is installed, we let’s load these packages into our R session:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pacman::p_load(dplyr, magrittr, nycflights13)</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nycflights13)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="filter-and-select" class="level2">
<h2 class="anchored" data-anchor-id="filter-and-select">Filter and Select</h2>
<p>The <code>filter</code> and <code>select</code> are two key verbs to know. These functions correspond to each of the “tidy data” rules presented above: <em>filter</em> let’s you narrow down your data to a specified set of rows (observations), while <em>select</em> allows you to narrow down your data to a specific set of columns (variables).</p>
<section id="select" class="level3">
<h3 class="anchored" data-anchor-id="select"><code>select</code></h3>
<section id="basic-information" class="level4">
<h4 class="anchored" data-anchor-id="basic-information">Basic information</h4>
<p>The <code>select</code> function in <code>dplyr</code> is used to select columns from a data frame, effectively subsetting the data to include only variables of interest. This is especially useful when you’re dealing with wide datasets with many variables, and you want to focus only on a few.</p>
<p><strong>Syntax</strong>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(data, column1, column2, ...)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Here, <code>column1</code>, <code>column2</code>, etc., are the names of the columns you want to keep.</p>
<p><span class="hi">Features:</span></p>
<ul>
<li><span class="note">Column Selection:</span> Keep only the columns you need.</li>
<li><span class="note">Reordering:</span> Rearrange the order of the columns.</li>
<li><span class="note">Renaming:</span> Can be combined with <code>rename</code> to rename columns in the output.</li>
<li><span class="note">Column Removal:</span> Use <code>-</code> to exclude specific columns. <!-- - [Ex.]{.ex} `select(data, -column1)` removes `column1` from `data` --></li>
</ul>
</section>
<section id="ex.-1" class="level4">
<h4 class="anchored" data-anchor-id="ex.-1"><span class="ex">Ex.</span></h4>
<p><span class="hi">Select Specific Columns</span></p>
<p>If you’re only interested in the departure and arrival times of the flights, you can use <code>select</code> to keep only those columns:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>subset_flights <span class="ot">=</span> <span class="fu">select</span>(flights, dep_time, arr_time)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>subset_flights</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><span class="hi">Rearrange Columns</span></p>
<p>You can rearrange the order of the columns simply by changing their order in the <code>select</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>subset_flights <span class="ot">=</span> <span class="fu">select</span>(flights, arr_time, dep_time)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>subset_flights</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><span class="hi">Exclude Columns</span></p>
<p>If you want all columns except for a few, you can use <code>-</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>subset_flights <span class="ot">=</span> <span class="fu">select</span>(flights, <span class="sc">-</span>year, <span class="sc">-</span>month, <span class="sc">-</span>day)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>subset_flights</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="practice-questions" class="level4">
<h4 class="anchored" data-anchor-id="practice-questions">Practice questions</h4>
<p>Here are some practice questions based on the <code>flights</code> dataset from the <a href="https://r4ds.had.co.nz/transform.html#select">R for Data Science book</a>:</p>
<ol type="1">
<li><p><strong>Select Time Columns</strong>: Use <code>select</code> to create a new data frame that includes only the columns related to time (<code>dep_time</code>, <code>sched_dep_time</code>, <code>arr_time</code>, <code>sched_arr_time</code>).</p></li>
<li><p><strong>Select Location Columns</strong>: Use <code>select</code> to create a new data frame that contains only the origin and destination airports.</p></li>
<li><p><strong>Drop ID Columns</strong>: Create a new data frame that contains all columns except for <code>year</code>, <code>month</code>, and <code>day</code>.</p></li>
</ol>
<p>These practice questions should give you a solid understanding of how to use <code>select</code> for column selection and reordering in the <code>flights</code> dataset.</p>
</section>
</section>
</section>
<section id="filter" class="level2">
<h2 class="anchored" data-anchor-id="filter"><code>filter</code></h2>
<section id="basic-information-1" class="level4">
<h4 class="anchored" data-anchor-id="basic-information-1">Basic Information</h4>
<p>The <code>filter</code> function in <code>dplyr</code> is used for subsetting a data frame, retaining only the rows that meet certain conditions. This operation is crucial when you’re interested in analyzing only a specific subset of your data based on one or more criteria.</p>
<p><span class="hi">Syntax:</span></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(data, condition1, condition2, ...)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Here, <code>data</code> is the data frame you’re working with, and <code>condition1, condition2, ...</code> are the conditions you want to apply.</p>
</section>
<section id="ex.-2" class="level4">
<h4 class="anchored" data-anchor-id="ex.-2"><span class="ex">Ex.</span></h4>
<p>To demonstrate, let’s use the <code>flights</code> dataset. Suppose you want to filter the data to only include flights that were delayed by more than 30 minutes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>delayed_flights <span class="ot">=</span> <span class="fu">filter</span>(flights, dep_delay <span class="sc">&gt;</span> <span class="dv">30</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>delayed_flights <span class="ot">=</span> <span class="fu">select</span>(delayed_flights, dep_delay)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>delayed_flights</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can also combine multiple conditions using logical operators like <code>&amp;</code> (and) or <code>|</code> (or).</p>
<p>For example, if you’re interested in flights that were delayed by more than 30 minutes and traveled a distance of more than 1000 miles:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>long_delayed_flights <span class="ot">=</span> <span class="fu">filter</span>(flights, dep_delay <span class="sc">&gt;</span> <span class="dv">30</span> <span class="sc">&amp;</span> distance <span class="sc">&gt;</span> <span class="dv">1000</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>long_delayed_flights <span class="ot">=</span> <span class="fu">select</span>(long_delayed_flights, dep_delay)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>long_delayed_flights</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="practice-questions-1" class="level4">
<h4 class="anchored" data-anchor-id="practice-questions-1">Practice questions</h4>
<p>To reinforce your understanding, try solving these practice questions based on the <code>flights</code> dataset:</p>
<ol type="1">
<li>Filter the <code>flights</code> data to include only flights operated by the carrier “UA” (United Airlines). How many such flights are there?
<ul>
<li>Hint: Use <code>nrow()</code> to find the number of rows in the filtered dataset.</li>
</ul></li>
<li>Filter the <code>flights</code> dataset to only include flights that departed from JFK and were delayed by less than 15 minutes. What is the average distance traveled by these flights?
<ul>
<li>Hint: Use <code>summarize()</code> to find the average distance.</li>
</ul></li>
<li>Filter the <code>flights</code> data to include flights that either departed from LGA and arrived at ORD, or departed from JFK and arrived at SFO. How many such unique routes are there?
<ul>
<li>Hint: Use <code>distinct()</code> to find unique routes based on the <code>origin</code> and <code>dest</code> columns.</li>
</ul></li>
</ol>
<p>These questions are designed to give you a deeper understanding of how to use <code>filter</code> to subset your data based on specific conditions.</p>
<hr>
</section>
</section>
<section id="mutate" class="level2">
<h2 class="anchored" data-anchor-id="mutate"><code>mutate</code></h2>
<hr>
</section>
<section id="aside-the-magrittr-pipe" class="level2">
<h2 class="anchored" data-anchor-id="aside-the-magrittr-pipe">Aside: The <code>magrittr</code> pipe</h2>
<hr>
</section>
<section id="other-key-dplyr-verbs" class="level2">
<h2 class="anchored" data-anchor-id="other-key-dplyr-verbs">Other Key <code>dplyr</code> verbs</h2>
<section id="arrange" class="level3">
<h3 class="anchored" data-anchor-id="arrange"><code>arrange</code></h3>
</section>
<section id="group_by-and-summarize" class="level3">
<h3 class="anchored" data-anchor-id="group_by-and-summarize"><code>group_by</code> and <code>summarize</code></h3>
</section>
</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p><code>summarise</code> works as well<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>